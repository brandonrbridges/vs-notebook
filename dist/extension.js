"use strict";var ze=Object.create;var K=Object.defineProperty;var He=Object.getOwnPropertyDescriptor;var $e=Object.getOwnPropertyNames;var Ye=Object.getPrototypeOf,Ue=Object.prototype.hasOwnProperty;var Be=(o,e)=>{for(var t in e)K(o,t,{get:e[t],enumerable:!0})},ge=(o,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of $e(e))!Ue.call(o,s)&&s!==t&&K(o,s,{get:()=>e[s],enumerable:!(i=He(e,s))||i.enumerable});return o};var k=(o,e,t)=>(t=o!=null?ze(Ye(o)):{},ge(e||!o||!o.__esModule?K(t,"default",{value:o,enumerable:!0}):t,o)),Ge=o=>ge(K({},"__esModule",{value:!0}),o);var It={};Be(It,{activate:()=>bt,deactivate:()=>Tt});module.exports=Ge(It);var u=k(require("vscode")),y=k(require("path")),E=k(require("fs"));var g=k(require("vscode")),T=k(require("fs")),x=k(require("path"));var We=require("fs"),se=require("fs/promises"),Le=require("events"),p=k(require("path"),1);var N=require("node:fs/promises"),Pe=require("node:stream"),S=require("node:path"),b={FILE_TYPE:"files",DIR_TYPE:"directories",FILE_DIR_TYPE:"files_directories",EVERYTHING_TYPE:"all"},ne={root:".",fileFilter:o=>!0,directoryFilter:o=>!0,type:b.FILE_TYPE,lstat:!1,depth:2147483648,alwaysStat:!1,highWaterMark:4096};Object.freeze(ne);var Ee="READDIRP_RECURSIVE_ERROR",Ve=new Set(["ENOENT","EPERM","EACCES","ELOOP",Ee]),_e=[b.DIR_TYPE,b.EVERYTHING_TYPE,b.FILE_DIR_TYPE,b.FILE_TYPE],Ke=new Set([b.DIR_TYPE,b.EVERYTHING_TYPE,b.FILE_DIR_TYPE]),qe=new Set([b.EVERYTHING_TYPE,b.FILE_DIR_TYPE,b.FILE_TYPE]),Je=o=>Ve.has(o.code),Qe=process.platform==="win32",ve=o=>!0,ye=o=>{if(o===void 0)return ve;if(typeof o=="function")return o;if(typeof o=="string"){let e=o.trim();return t=>t.basename===e}if(Array.isArray(o)){let e=o.map(t=>t.trim());return t=>e.some(i=>t.basename===i)}return ve},ae=class extends Pe.Readable{constructor(e={}){super({objectMode:!0,autoDestroy:!0,highWaterMark:e.highWaterMark});let t={...ne,...e},{root:i,type:s}=t;this._fileFilter=ye(t.fileFilter),this._directoryFilter=ye(t.directoryFilter);let r=t.lstat?N.lstat:N.stat;Qe?this._stat=a=>r(a,{bigint:!0}):this._stat=r,this._maxDepth=t.depth??ne.depth,this._wantsDir=s?Ke.has(s):!1,this._wantsFile=s?qe.has(s):!1,this._wantsEverything=s===b.EVERYTHING_TYPE,this._root=(0,S.resolve)(i),this._isDirent=!t.alwaysStat,this._statsProp=this._isDirent?"dirent":"stats",this._rdOptions={encoding:"utf8",withFileTypes:this._isDirent},this.parents=[this._exploreDir(i,1)],this.reading=!1,this.parent=void 0}async _read(e){if(!this.reading){this.reading=!0;try{for(;!this.destroyed&&e>0;){let t=this.parent,i=t&&t.files;if(i&&i.length>0){let{path:s,depth:r}=t,a=i.splice(0,e).map(c=>this._formatEntry(c,s)),n=await Promise.all(a);for(let c of n){if(!c)continue;if(this.destroyed)return;let h=await this._getEntryType(c);h==="directory"&&this._directoryFilter(c)?(r<=this._maxDepth&&this.parents.push(this._exploreDir(c.fullPath,r+1)),this._wantsDir&&(this.push(c),e--)):(h==="file"||this._includeAsFile(c))&&this._fileFilter(c)&&this._wantsFile&&(this.push(c),e--)}}else{let s=this.parents.pop();if(!s){this.push(null);break}if(this.parent=await s,this.destroyed)return}}}catch(t){this.destroy(t)}finally{this.reading=!1}}}async _exploreDir(e,t){let i;try{i=await(0,N.readdir)(e,this._rdOptions)}catch(s){this._onError(s)}return{files:i,depth:t,path:e}}async _formatEntry(e,t){let i,s=this._isDirent?e.name:e;try{let r=(0,S.resolve)((0,S.join)(t,s));i={path:(0,S.relative)(this._root,r),fullPath:r,basename:s},i[this._statsProp]=this._isDirent?e:await this._stat(r)}catch(r){this._onError(r);return}return i}_onError(e){Je(e)&&!this.destroyed?this.emit("warn",e):this.destroy(e)}async _getEntryType(e){if(!e&&this._statsProp in e)return"";let t=e[this._statsProp];if(t.isFile())return"file";if(t.isDirectory())return"directory";if(t&&t.isSymbolicLink()){let i=e.fullPath;try{let s=await(0,N.realpath)(i),r=await(0,N.lstat)(s);if(r.isFile())return"file";if(r.isDirectory()){let a=s.length;if(i.startsWith(s)&&i.substr(a,1)===S.sep){let n=new Error(`Circular symlink detected: "${i}" points to "${s}"`);return n.code=Ee,this._onError(n)}return"directory"}}catch(s){return this._onError(s),""}}}_includeAsFile(e){let t=e&&e[this._statsProp];return t&&this._wantsEverything&&!t.isDirectory()}};function be(o,e={}){let t=e.entryType||e.type;if(t==="both"&&(t=b.FILE_DIR_TYPE),t&&(e.type=t),o){if(typeof o!="string")throw new TypeError("readdirp: root argument must be a string. Usage: readdirp(root, options)");if(t&&!_e.includes(t))throw new Error(`readdirp: Invalid type passed. Use one of ${_e.join(", ")}`)}else throw new Error("readdirp: root argument is required. Usage: readdirp(root, options)");return e.root=o,new ae(e)}var j=require("fs"),R=require("fs/promises"),_=k(require("path"),1),Ie=require("os"),Xe="data",le="end",ke="close",Z=()=>{};var ee=process.platform,de=ee==="win32",Ze=ee==="darwin",et=ee==="linux",tt=ee==="freebsd",De=(0,Ie.type)()==="OS400",v={ALL:"all",READY:"ready",ADD:"add",CHANGE:"change",ADD_DIR:"addDir",UNLINK:"unlink",UNLINK_DIR:"unlinkDir",RAW:"raw",ERROR:"error"},D=v,st="watch",it={lstat:R.lstat,stat:R.stat},A="listeners",q="errHandlers",z="rawEmitters",ot=[A,q,z],rt=new Set(["3dm","3ds","3g2","3gp","7z","a","aac","adp","afdesign","afphoto","afpub","ai","aif","aiff","alz","ape","apk","appimage","ar","arj","asf","au","avi","bak","baml","bh","bin","bk","bmp","btif","bz2","bzip2","cab","caf","cgm","class","cmx","cpio","cr2","cur","dat","dcm","deb","dex","djvu","dll","dmg","dng","doc","docm","docx","dot","dotm","dra","DS_Store","dsk","dts","dtshd","dvb","dwg","dxf","ecelp4800","ecelp7470","ecelp9600","egg","eol","eot","epub","exe","f4v","fbs","fh","fla","flac","flatpak","fli","flv","fpx","fst","fvt","g3","gh","gif","graffle","gz","gzip","h261","h263","h264","icns","ico","ief","img","ipa","iso","jar","jpeg","jpg","jpgv","jpm","jxr","key","ktx","lha","lib","lvp","lz","lzh","lzma","lzo","m3u","m4a","m4v","mar","mdi","mht","mid","midi","mj2","mka","mkv","mmr","mng","mobi","mov","movie","mp3","mp4","mp4a","mpeg","mpg","mpga","mxu","nef","npx","numbers","nupkg","o","odp","ods","odt","oga","ogg","ogv","otf","ott","pages","pbm","pcx","pdb","pdf","pea","pgm","pic","png","pnm","pot","potm","potx","ppa","ppam","ppm","pps","ppsm","ppsx","ppt","pptm","pptx","psd","pya","pyc","pyo","pyv","qt","rar","ras","raw","resources","rgb","rip","rlc","rmf","rmvb","rpm","rtf","rz","s3m","s7z","scpt","sgi","shar","snap","sil","sketch","slk","smv","snk","so","stl","suo","sub","swf","tar","tbz","tbz2","tga","tgz","thmx","tif","tiff","tlz","ttc","ttf","txz","udf","uvh","uvi","uvm","uvp","uvs","uvu","viv","vob","war","wav","wax","wbmp","wdp","weba","webm","webp","whl","wim","wm","wma","wmv","wmx","woff","woff2","wrm","wvx","xbm","xif","xla","xlam","xls","xlsb","xlsm","xlsx","xlt","xltm","xltx","xm","xmind","xpi","xpm","xwd","xz","z","zip","zipx"]),nt=o=>rt.has(_.extname(o).slice(1).toLowerCase()),he=(o,e)=>{o instanceof Set?o.forEach(e):e(o)},Y=(o,e,t)=>{let i=o[e];i instanceof Set||(o[e]=i=new Set([i])),i.add(t)},at=o=>e=>{let t=o[e];t instanceof Set?t.clear():delete o[e]},U=(o,e,t)=>{let i=o[e];i instanceof Set?i.delete(t):i===t&&delete o[e]},Re=o=>o instanceof Set?o.size===0:!o,J=new Map;function Te(o,e,t,i,s){let r=(a,n)=>{t(o),s(a,n,{watchedPath:o}),n&&o!==n&&Q(_.resolve(o,n),A,_.join(o,n))};try{return(0,j.watch)(o,{persistent:e.persistent},r)}catch(a){i(a);return}}var Q=(o,e,t,i,s)=>{let r=J.get(o);r&&he(r[e],a=>{a(t,i,s)})},ct=(o,e,t,i)=>{let{listener:s,errHandler:r,rawEmitter:a}=i,n=J.get(e),c;if(!t.persistent)return c=Te(o,t,s,r,a),c?c.close.bind(c):void 0;if(n)Y(n,A,s),Y(n,q,r),Y(n,z,a);else{if(c=Te(o,t,Q.bind(null,e,A),r,Q.bind(null,e,z)),!c)return;c.on(D.ERROR,async h=>{let l=Q.bind(null,e,q);if(n&&(n.watcherUnusable=!0),de&&h.code==="EPERM")try{await(await(0,R.open)(o,"r")).close(),l(h)}catch{}else l(h)}),n={listeners:s,errHandlers:r,rawEmitters:a,watcher:c},J.set(e,n)}return()=>{U(n,A,s),U(n,q,r),U(n,z,a),Re(n.listeners)&&(n.watcher.close(),J.delete(e),ot.forEach(at(n)),n.watcher=void 0,Object.freeze(n))}},ce=new Map,ht=(o,e,t,i)=>{let{listener:s,rawEmitter:r}=i,a=ce.get(e),n=a&&a.options;return n&&(n.persistent<t.persistent||n.interval>t.interval)&&((0,j.unwatchFile)(e),a=void 0),a?(Y(a,A,s),Y(a,z,r)):(a={listeners:s,rawEmitters:r,options:t,watcher:(0,j.watchFile)(e,t,(c,h)=>{he(a.rawEmitters,f=>{f(D.CHANGE,e,{curr:c,prev:h})});let l=c.mtimeMs;(c.size!==h.size||l>h.mtimeMs||l===0)&&he(a.listeners,f=>f(o,c))})},ce.set(e,a)),()=>{U(a,A,s),U(a,z,r),Re(a.listeners)&&(ce.delete(e),(0,j.unwatchFile)(e),a.options=a.watcher=void 0,Object.freeze(a))}},X=class{constructor(e){this.fsw=e,this._boundHandleError=t=>e._handleError(t)}_watchWithNodeFs(e,t){let i=this.fsw.options,s=_.dirname(e),r=_.basename(e);this.fsw._getWatchedDir(s).add(r);let n=_.resolve(e),c={persistent:i.persistent};t||(t=Z);let h;if(i.usePolling){let l=i.interval!==i.binaryInterval;c.interval=l&&nt(r)?i.binaryInterval:i.interval,h=ht(e,n,c,{listener:t,rawEmitter:this.fsw._emitRaw})}else h=ct(e,n,c,{listener:t,errHandler:this._boundHandleError,rawEmitter:this.fsw._emitRaw});return h}_handleFile(e,t,i){if(this.fsw.closed)return;let s=_.dirname(e),r=_.basename(e),a=this.fsw._getWatchedDir(s),n=t;if(a.has(r))return;let c=async(l,f)=>{if(this.fsw._throttle(st,e,5)){if(!f||f.mtimeMs===0)try{let d=await(0,R.stat)(e);if(this.fsw.closed)return;let m=d.atimeMs,w=d.mtimeMs;if((!m||m<=w||w!==n.mtimeMs)&&this.fsw._emit(D.CHANGE,e,d),(Ze||et||tt)&&n.ino!==d.ino){this.fsw._closeFile(l),n=d;let P=this._watchWithNodeFs(e,c);P&&this.fsw._addPathCloser(l,P)}else n=d}catch{this.fsw._remove(s,r)}else if(a.has(r)){let d=f.atimeMs,m=f.mtimeMs;(!d||d<=m||m!==n.mtimeMs)&&this.fsw._emit(D.CHANGE,e,f),n=f}}},h=this._watchWithNodeFs(e,c);if(!(i&&this.fsw.options.ignoreInitial)&&this.fsw._isntIgnored(e)){if(!this.fsw._throttle(D.ADD,e,0))return;this.fsw._emit(D.ADD,e,t)}return h}async _handleSymlink(e,t,i,s){if(this.fsw.closed)return;let r=e.fullPath,a=this.fsw._getWatchedDir(t);if(!this.fsw.options.followSymlinks){this.fsw._incrReadyCount();let n;try{n=await(0,R.realpath)(i)}catch{return this.fsw._emitReady(),!0}return this.fsw.closed?void 0:(a.has(s)?this.fsw._symlinkPaths.get(r)!==n&&(this.fsw._symlinkPaths.set(r,n),this.fsw._emit(D.CHANGE,i,e.stats)):(a.add(s),this.fsw._symlinkPaths.set(r,n),this.fsw._emit(D.ADD,i,e.stats)),this.fsw._emitReady(),!0)}if(this.fsw._symlinkPaths.has(r))return!0;this.fsw._symlinkPaths.set(r,!0)}_handleRead(e,t,i,s,r,a,n){if(e=_.join(e,""),n=this.fsw._throttle("readdir",e,1e3),!n)return;let c=this.fsw._getWatchedDir(i.path),h=new Set,l=this.fsw._readdirp(e,{fileFilter:f=>i.filterPath(f),directoryFilter:f=>i.filterDir(f)});if(l)return l.on(Xe,async f=>{if(this.fsw.closed){l=void 0;return}let d=f.path,m=_.join(e,d);if(h.add(d),!(f.stats.isSymbolicLink()&&await this._handleSymlink(f,e,m,d))){if(this.fsw.closed){l=void 0;return}(d===s||!s&&!c.has(d))&&(this.fsw._incrReadyCount(),m=_.join(r,_.relative(r,m)),this._addToNodeFs(m,t,i,a+1))}}).on(D.ERROR,this._boundHandleError),new Promise((f,d)=>{if(!l)return d();l.once(le,()=>{if(this.fsw.closed){l=void 0;return}let m=n?n.clear():!1;f(void 0),c.getChildren().filter(w=>w!==e&&!h.has(w)).forEach(w=>{this.fsw._remove(e,w)}),l=void 0,m&&this._handleRead(e,!1,i,s,r,a,n)})})}async _handleDir(e,t,i,s,r,a,n){let c=this.fsw._getWatchedDir(_.dirname(e)),h=c.has(_.basename(e));!(i&&this.fsw.options.ignoreInitial)&&!r&&!h&&this.fsw._emit(D.ADD_DIR,e,t),c.add(_.basename(e)),this.fsw._getWatchedDir(e);let l,f,d=this.fsw.options.depth;if((d==null||s<=d)&&!this.fsw._symlinkPaths.has(n)){if(!r&&(await this._handleRead(e,i,a,r,e,s,l),this.fsw.closed))return;f=this._watchWithNodeFs(e,(m,w)=>{w&&w.mtimeMs===0||this._handleRead(m,!1,a,r,e,s,l)})}return f}async _addToNodeFs(e,t,i,s,r){let a=this.fsw._emitReady;if(this.fsw._isIgnored(e)||this.fsw.closed)return a(),!1;let n=this.fsw._getWatchHelpers(e);i&&(n.filterPath=c=>i.filterPath(c),n.filterDir=c=>i.filterDir(c));try{let c=await it[n.statMethod](n.watchPath);if(this.fsw.closed)return;if(this.fsw._isIgnored(n.watchPath,c))return a(),!1;let h=this.fsw.options.followSymlinks,l;if(c.isDirectory()){let f=_.resolve(e),d=h?await(0,R.realpath)(e):e;if(this.fsw.closed||(l=await this._handleDir(n.watchPath,c,t,s,r,n,d),this.fsw.closed))return;f!==d&&d!==void 0&&this.fsw._symlinkPaths.set(f,d)}else if(c.isSymbolicLink()){let f=h?await(0,R.realpath)(e):e;if(this.fsw.closed)return;let d=_.dirname(n.watchPath);if(this.fsw._getWatchedDir(d).add(n.watchPath),this.fsw._emit(D.ADD,n.watchPath,c),l=await this._handleDir(d,c,t,s,e,n,f),this.fsw.closed)return;f!==void 0&&this.fsw._symlinkPaths.set(_.resolve(e),f)}else l=this._handleFile(n.watchPath,c,t);return a(),l&&this.fsw._addPathCloser(e,l),!1}catch(c){if(this.fsw._handleError(c))return a(),e}}};var fe="/",lt="//",Ae=".",dt="..",ft="string",ut=/\\/g,xe=/\/\//,mt=/\..*\.(sw[px])$|~$|\.subl.*\.tmp/,pt=/^\.[/\\]/;function te(o){return Array.isArray(o)?o:[o]}var ue=o=>typeof o=="object"&&o!==null&&!(o instanceof RegExp);function wt(o){return typeof o=="function"?o:typeof o=="string"?e=>o===e:o instanceof RegExp?e=>o.test(e):typeof o=="object"&&o!==null?e=>{if(o.path===e)return!0;if(o.recursive){let t=p.relative(o.path,e);return t?!t.startsWith("..")&&!p.isAbsolute(t):!1}return!1}:()=>!1}function gt(o){if(typeof o!="string")throw new Error("string expected");o=p.normalize(o),o=o.replace(/\\/g,"/");let e=!1;o.startsWith("//")&&(e=!0);let t=/\/\//;for(;o.match(t);)o=o.replace(t,"/");return e&&(o="/"+o),o}function Ne(o,e,t){let i=gt(e);for(let s=0;s<o.length;s++){let r=o[s];if(r(i,t))return!0}return!1}function _t(o,e){if(o==null)throw new TypeError("anymatch: specify first argument");let i=te(o).map(s=>wt(s));return e==null?(s,r)=>Ne(i,s,r):Ne(i,e)}var Se=o=>{let e=te(o).flat();if(!e.every(t=>typeof t===ft))throw new TypeError(`Non-string provided as watch path: ${e}`);return e.map(je)},Fe=o=>{let e=o.replace(ut,fe),t=!1;for(e.startsWith(lt)&&(t=!0);e.match(xe);)e=e.replace(xe,fe);return t&&(e=fe+e),e},je=o=>Fe(p.normalize(Fe(o))),Ce=(o="")=>e=>typeof e=="string"?je(p.isAbsolute(e)?e:p.join(o,e)):e,vt=(o,e)=>p.isAbsolute(o)?o:p.join(e,o),yt=Object.freeze(new Set),me=class{constructor(e,t){this.path=e,this._removeWatcher=t,this.items=new Set}add(e){let{items:t}=this;t&&e!==Ae&&e!==dt&&t.add(e)}async remove(e){let{items:t}=this;if(!t||(t.delete(e),t.size>0))return;let i=this.path;try{await(0,se.readdir)(i)}catch{this._removeWatcher&&this._removeWatcher(p.dirname(i),p.basename(i))}}has(e){let{items:t}=this;if(t)return t.has(e)}getChildren(){let{items:e}=this;return e?[...e.values()]:[]}dispose(){this.items.clear(),this.path="",this._removeWatcher=Z,this.items=yt,Object.freeze(this)}},Pt="stat",Et="lstat",pe=class{constructor(e,t,i){this.fsw=i;let s=e;this.path=e=e.replace(pt,""),this.watchPath=s,this.fullWatchPath=p.resolve(s),this.dirParts=[],this.dirParts.forEach(r=>{r.length>1&&r.pop()}),this.followSymlinks=t,this.statMethod=t?Pt:Et}entryPath(e){return p.join(this.watchPath,p.relative(this.watchPath,e.fullPath))}filterPath(e){let{stats:t}=e;if(t&&t.isSymbolicLink())return this.filterDir(e);let i=this.entryPath(e);return this.fsw._isntIgnored(i,t)&&this.fsw._hasReadPermissions(t)}filterDir(e){return this.fsw._isntIgnored(this.entryPath(e),e.stats)}},we=class extends Le.EventEmitter{constructor(e={}){super(),this.closed=!1,this._closers=new Map,this._ignoredPaths=new Set,this._throttled=new Map,this._streams=new Set,this._symlinkPaths=new Map,this._watched=new Map,this._pendingWrites=new Map,this._pendingUnlinks=new Map,this._readyCount=0,this._readyEmitted=!1;let t=e.awaitWriteFinish,i={stabilityThreshold:2e3,pollInterval:100},s={persistent:!0,ignoreInitial:!1,ignorePermissionErrors:!1,interval:100,binaryInterval:300,followSymlinks:!0,usePolling:!1,atomic:!0,...e,ignored:e.ignored?te(e.ignored):te([]),awaitWriteFinish:t===!0?i:typeof t=="object"?{...i,...t}:!1};De&&(s.usePolling=!0),s.atomic===void 0&&(s.atomic=!s.usePolling);let r=process.env.CHOKIDAR_USEPOLLING;if(r!==void 0){let c=r.toLowerCase();c==="false"||c==="0"?s.usePolling=!1:c==="true"||c==="1"?s.usePolling=!0:s.usePolling=!!c}let a=process.env.CHOKIDAR_INTERVAL;a&&(s.interval=Number.parseInt(a,10));let n=0;this._emitReady=()=>{n++,n>=this._readyCount&&(this._emitReady=Z,this._readyEmitted=!0,process.nextTick(()=>this.emit(v.READY)))},this._emitRaw=(...c)=>this.emit(v.RAW,...c),this._boundRemove=this._remove.bind(this),this.options=s,this._nodeFsHandler=new X(this),Object.freeze(s)}_addIgnoredPath(e){if(ue(e)){for(let t of this._ignoredPaths)if(ue(t)&&t.path===e.path&&t.recursive===e.recursive)return}this._ignoredPaths.add(e)}_removeIgnoredPath(e){if(this._ignoredPaths.delete(e),typeof e=="string")for(let t of this._ignoredPaths)ue(t)&&t.path===e&&this._ignoredPaths.delete(t)}add(e,t,i){let{cwd:s}=this.options;this.closed=!1,this._closePromise=void 0;let r=Se(e);return s&&(r=r.map(a=>vt(a,s))),r.forEach(a=>{this._removeIgnoredPath(a)}),this._userIgnored=void 0,this._readyCount||(this._readyCount=0),this._readyCount+=r.length,Promise.all(r.map(async a=>{let n=await this._nodeFsHandler._addToNodeFs(a,!i,void 0,0,t);return n&&this._emitReady(),n})).then(a=>{this.closed||a.forEach(n=>{n&&this.add(p.dirname(n),p.basename(t||n))})}),this}unwatch(e){if(this.closed)return this;let t=Se(e),{cwd:i}=this.options;return t.forEach(s=>{!p.isAbsolute(s)&&!this._closers.has(s)&&(i&&(s=p.join(i,s)),s=p.resolve(s)),this._closePath(s),this._addIgnoredPath(s),this._watched.has(s)&&this._addIgnoredPath({path:s,recursive:!0}),this._userIgnored=void 0}),this}close(){if(this._closePromise)return this._closePromise;this.closed=!0,this.removeAllListeners();let e=[];return this._closers.forEach(t=>t.forEach(i=>{let s=i();s instanceof Promise&&e.push(s)})),this._streams.forEach(t=>t.destroy()),this._userIgnored=void 0,this._readyCount=0,this._readyEmitted=!1,this._watched.forEach(t=>t.dispose()),this._closers.clear(),this._watched.clear(),this._streams.clear(),this._symlinkPaths.clear(),this._throttled.clear(),this._closePromise=e.length?Promise.all(e).then(()=>{}):Promise.resolve(),this._closePromise}getWatched(){let e={};return this._watched.forEach((t,i)=>{let r=(this.options.cwd?p.relative(this.options.cwd,i):i)||Ae;e[r]=t.getChildren().sort()}),e}emitWithAll(e,t){this.emit(e,...t),e!==v.ERROR&&this.emit(v.ALL,e,...t)}async _emit(e,t,i){if(this.closed)return;let s=this.options;de&&(t=p.normalize(t)),s.cwd&&(t=p.relative(s.cwd,t));let r=[t];i!=null&&r.push(i);let a=s.awaitWriteFinish,n;if(a&&(n=this._pendingWrites.get(t)))return n.lastChange=new Date,this;if(s.atomic){if(e===v.UNLINK)return this._pendingUnlinks.set(t,[e,...r]),setTimeout(()=>{this._pendingUnlinks.forEach((c,h)=>{this.emit(...c),this.emit(v.ALL,...c),this._pendingUnlinks.delete(h)})},typeof s.atomic=="number"?s.atomic:100),this;e===v.ADD&&this._pendingUnlinks.has(t)&&(e=v.CHANGE,this._pendingUnlinks.delete(t))}if(a&&(e===v.ADD||e===v.CHANGE)&&this._readyEmitted){let c=(h,l)=>{h?(e=v.ERROR,r[0]=h,this.emitWithAll(e,r)):l&&(r.length>1?r[1]=l:r.push(l),this.emitWithAll(e,r))};return this._awaitWriteFinish(t,a.stabilityThreshold,e,c),this}if(e===v.CHANGE&&!this._throttle(v.CHANGE,t,50))return this;if(s.alwaysStat&&i===void 0&&(e===v.ADD||e===v.ADD_DIR||e===v.CHANGE)){let c=s.cwd?p.join(s.cwd,t):t,h;try{h=await(0,se.stat)(c)}catch{}if(!h||this.closed)return;r.push(h)}return this.emitWithAll(e,r),this}_handleError(e){let t=e&&e.code;return e&&t!=="ENOENT"&&t!=="ENOTDIR"&&(!this.options.ignorePermissionErrors||t!=="EPERM"&&t!=="EACCES")&&this.emit(v.ERROR,e),e||this.closed}_throttle(e,t,i){this._throttled.has(e)||this._throttled.set(e,new Map);let s=this._throttled.get(e);if(!s)throw new Error("invalid throttle");let r=s.get(t);if(r)return r.count++,!1;let a,n=()=>{let h=s.get(t),l=h?h.count:0;return s.delete(t),clearTimeout(a),h&&clearTimeout(h.timeoutObject),l};a=setTimeout(n,i);let c={timeoutObject:a,clear:n,count:0};return s.set(t,c),c}_incrReadyCount(){return this._readyCount++}_awaitWriteFinish(e,t,i,s){let r=this.options.awaitWriteFinish;if(typeof r!="object")return;let a=r.pollInterval,n,c=e;this.options.cwd&&!p.isAbsolute(e)&&(c=p.join(this.options.cwd,e));let h=new Date,l=this._pendingWrites;function f(d){(0,We.stat)(c,(m,w)=>{if(m||!l.has(e)){m&&m.code!=="ENOENT"&&s(m);return}let P=Number(new Date);d&&w.size!==d.size&&(l.get(e).lastChange=P);let F=l.get(e);P-F.lastChange>=t?(l.delete(e),s(void 0,w)):n=setTimeout(f,a,w)})}l.has(e)||(l.set(e,{lastChange:h,cancelWait:()=>(l.delete(e),clearTimeout(n),i)}),n=setTimeout(f,a))}_isIgnored(e,t){if(this.options.atomic&&mt.test(e))return!0;if(!this._userIgnored){let{cwd:i}=this.options,r=(this.options.ignored||[]).map(Ce(i)),n=[...[...this._ignoredPaths].map(Ce(i)),...r];this._userIgnored=_t(n,void 0)}return this._userIgnored(e,t)}_isntIgnored(e,t){return!this._isIgnored(e,t)}_getWatchHelpers(e){return new pe(e,this.options.followSymlinks,this)}_getWatchedDir(e){let t=p.resolve(e);return this._watched.has(t)||this._watched.set(t,new me(t,this._boundRemove)),this._watched.get(t)}_hasReadPermissions(e){return this.options.ignorePermissionErrors?!0:!!(Number(e.mode)&256)}_remove(e,t,i){let s=p.join(e,t),r=p.resolve(s);if(i=i??(this._watched.has(s)||this._watched.has(r)),!this._throttle("remove",s,100))return;!i&&this._watched.size===1&&this.add(e,t,!0),this._getWatchedDir(s).getChildren().forEach(d=>this._remove(s,d));let c=this._getWatchedDir(e),h=c.has(t);c.remove(t),this._symlinkPaths.has(r)&&this._symlinkPaths.delete(r);let l=s;if(this.options.cwd&&(l=p.relative(this.options.cwd,s)),this.options.awaitWriteFinish&&this._pendingWrites.has(l)&&this._pendingWrites.get(l).cancelWait()===v.ADD)return;this._watched.delete(s),this._watched.delete(r);let f=i?v.UNLINK_DIR:v.UNLINK;h&&!this._isIgnored(s)&&this._emit(f,s),this._closePath(s)}_closePath(e){this._closeFile(e);let t=p.dirname(e);this._getWatchedDir(t).remove(p.basename(e))}_closeFile(e){let t=this._closers.get(e);t&&(t.forEach(i=>i()),this._closers.delete(e))}_addPathCloser(e,t){if(!t)return;let i=this._closers.get(e);i||(i=[],this._closers.set(e,i)),i.push(t)}_readdirp(e,t){if(this.closed)return;let i={type:v.ALL,alwaysStat:!0,lstat:!0,...t,depth:0},s=be(e,i);return this._streams.add(s),s.once(ke,()=>{s=void 0}),s.once(le,()=>{s&&(this._streams.delete(s),s=void 0)}),s}};function ie(o,e={}){let t=new we(e);return t.add(o),t}var G=class{constructor(e,t){this.workspaceRoot=e;this.isGlobal=t}_onDidChangeTreeData=new g.EventEmitter;onDidChangeTreeData=this._onDidChangeTreeData.event;watcher;refreshTimeout;refresh(){this._onDidChangeTreeData.fire()}startWatching(){if(!this.workspaceRoot)return;let e=this.isGlobal?this.workspaceRoot:x.join(this.workspaceRoot,".vs-notebook");try{T.existsSync(e)||T.mkdirSync(e,{recursive:!0}),this.watcher=ie(x.join(e,"*.md"),{ignored:/^\./,persistent:!0,ignoreInitial:!0,awaitWriteFinish:{stabilityThreshold:300,pollInterval:100}}),this.watcher.on("add",()=>this.debouncedRefresh()).on("change",()=>this.debouncedRefresh()).on("unlink",()=>this.debouncedRefresh()).on("error",t=>{console.error(`VS Notebook: Error watching ${this.isGlobal?"global":"workspace"} notes directory:`,t),setTimeout(()=>{this.watcher||this.startWatching()},5e3)})}catch(t){console.error(`VS Notebook: Failed to start ${this.isGlobal?"global":"workspace"} file watcher:`,t)}}debouncedRefresh(){this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(()=>{this.refresh()},100)}dispose(){this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.watcher&&this.watcher.close()}getTreeItem(e){return e}getChildren(e){if(!this.workspaceRoot)return g.window.showInformationMessage("No workspace open"),Promise.resolve([]);let t=this.isGlobal?this.workspaceRoot:x.join(this.workspaceRoot,".vs-notebook");if(!T.existsSync(t))return Promise.resolve([]);if(e&&e instanceof B)return Promise.resolve(e.children);let s=T.readdirSync(t).filter(c=>c.endsWith(".md")).map(c=>{let h=x.join(t,c);return new H(c,h)}),a=g.workspace.getConfiguration("vs-notebook").get("groupBy","none");if(this.isGlobal&&a==="file"&&(a="tag"),a==="none")return Promise.resolve(s);let n=this.groupNotes(s,a);return Promise.resolve(n)}async search(e){if(!this.workspaceRoot)return[];let t=x.join(this.workspaceRoot,".vs-notebook");if(!T.existsSync(t))return[];let i=T.readdirSync(t).filter(a=>a.endsWith(".md")),s=e.toLowerCase(),r=[];for(let a of i){let n=x.join(t,a);T.readFileSync(n,"utf-8").toLowerCase().includes(s)&&r.push(new H(a,n))}return r}groupNotes(e,t){switch(t){case"file":return this.groupByFile(e);case"tag":return this.groupByTag(e);default:return e}}groupByFile(e){let t=new Map;for(let s of e){let r=H.readFrontmatter(s.fullPath),a=r.file?x.basename(r.file):"Unknown File";t.has(a)||t.set(a,[]),t.get(a).push(s)}let i=[];for(let[s,r]of t)i.push(new B(s,r,"file"));return i.sort((s,r)=>s.label.localeCompare(r.label))}groupByTag(e){let t=new Map;for(let s of e){let a=H.readFrontmatter(s.fullPath).tags?.split(",").map(c=>c.trim()).filter(Boolean)??[],n=a.length>0?a[0]:"Untagged";n||(n="Untagged"),n=n.charAt(0).toUpperCase()+n.slice(1),t.has(n)||t.set(n,[]),t.get(n).push(s)}let i=[];for(let[s,r]of t)i.push(new B(s,r,"tag"));return i.sort((s,r)=>s.label.localeCompare(r.label))}},B=class extends g.TreeItem{constructor(t,i,s){super(t,g.TreeItemCollapsibleState.Expanded);this.label=t;this.children=i;this.groupType=s;this.tooltip=`${this.children.length} note${this.children.length!==1?"s":""}`,this.description=`${this.children.length}`,s==="file"?this.iconPath=new g.ThemeIcon("file"):this.iconPath=new g.ThemeIcon("tag"),this.contextValue="groupItem"}},H=class o extends g.TreeItem{constructor(t,i){super(t,g.TreeItemCollapsibleState.None);this.label=t;this.fullPath=i;let s=o.readFrontmatter(i),r=s.tags?.split(",").map(a=>a.trim())??[];r.includes("feature")?this.iconPath=new g.ThemeIcon("star",new g.ThemeColor("charts.green")):r.includes("bug")?this.iconPath=new g.ThemeIcon("bug",new g.ThemeColor("errorForeground")):r.includes("todo")?this.iconPath=new g.ThemeIcon("checklist",new g.ThemeColor("charts.yellow")):r.includes("refactor")?this.iconPath=new g.ThemeIcon("tools",new g.ThemeColor("charts.blue")):this.iconPath=new g.ThemeIcon("note"),this.tooltip=`${t}
${s.file??""} : ${s.line??""}${s.tags?`
Tags: `+s.tags:""}`,this.description=s.file?`${x.basename(s.file)} ${s.tags?` \u2022 ${s.tags}`:""}`:"",this.command={command:"vs-notebook.openNote",title:"Open Note",arguments:[this.fullPath]},this.resourceUri=g.Uri.file(this.fullPath),this.contextValue="noteItem"}static readFrontmatter(t){try{let s=T.readFileSync(t,"utf-8").match(/^---\n([\s\S]+?)\n---/);if(s){let a=s[1].split(`
`),n={};for(let c of a){let[h,...l]=c.split(":");n[h.trim()]=l.join(":").trim()}return{file:n.file,line:n.line,tags:n.tags}}}catch(i){console.error("Failed to read frontmatter:",i)}return{}}};var $=k(require("vscode")),M=k(require("fs")),W=k(require("path"));var oe=class{constructor(e){this.workspaceRoot=e;this.refreshNotes(),this.startWatching()}_onDidChangeCodeLenses=new $.EventEmitter;onDidChangeCodeLenses=this._onDidChangeCodeLenses.event;notes={};watcher;refreshTimeout;refreshNotes(){this.notes={};let e=W.join(this.workspaceRoot,".vs-notebook");if(!M.existsSync(e))return;let t=M.readdirSync(e).filter(i=>i.endsWith(".md"));for(let i of t){let s=W.join(e,i),a=M.readFileSync(s,"utf8").match(/^---\n([\s\S]+?)\n---/);if(!a)continue;let n=Object.fromEntries(a[1].split(`
`).map(c=>{let[h,...l]=c.split(":");return[h.trim(),l.join(":").trim()]}));if(n.file&&n.line){let c=W.resolve(n.file),h=n.line,l=null,f=null;if(h.includes("-")){let d=h.split("-").map(m=>parseInt(m));d.length===2&&d.every(m=>!isNaN(m))&&(l=d[0]-1,f=d[1]-1)}else{let d=parseInt(h);isNaN(d)||(l=f=d-1)}l!==null&&f!==null&&(this.notes[c]||(this.notes[c]=[]),this.notes[c].push({start:l,end:f}))}}}refresh(){this.refreshNotes(),this._onDidChangeCodeLenses.fire()}startWatching(){if(!this.workspaceRoot)return;let e=W.join(this.workspaceRoot,".vs-notebook");if(M.existsSync(e))try{this.watcher=ie(W.join(e,"*.md"),{ignored:/^\./,persistent:!0,ignoreInitial:!0,awaitWriteFinish:{stabilityThreshold:300,pollInterval:100}}),this.watcher.on("add",()=>this.debouncedRefresh()).on("change",()=>this.debouncedRefresh()).on("unlink",()=>this.debouncedRefresh()).on("error",t=>{console.error("VS Notebook: Error watching workspace notes for code lens:",t),setTimeout(()=>{this.watcher||this.startWatching()},5e3)})}catch(t){console.error("VS Notebook: Failed to start code lens file watcher:",t)}}debouncedRefresh(){this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(()=>{this.refresh()},100)}dispose(){this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.watcher&&this.watcher.close()}provideCodeLenses(e){let t=W.resolve(e.uri.fsPath),s=(this.notes[t]??[]).reduce((a,n)=>{let c=n.start;return a[c]||(a[c]=[]),a[c].push(n),a},{}),r=[];return Object.entries(s).forEach(([a,n])=>{let c=parseInt(a),h=n.length,l=n.length===1&&n[0].start===n[0].end,f=l?`${h} note${h>1?"s":""} for this line`:`${h} note${h>1?"s":""} for lines ${n[0].start+1}-${n[0].end+1}`;r.push(new $.CodeLens(new $.Range(c,0,c,0),{title:f,command:l?"vs-notebook.openNotesForLine":"vs-notebook.openNotesForRange",arguments:l?[t,c+1]:[t,n[0].start+1,n[0].end+1]}))}),r}};function bt(o){let e=u.workspace.workspaceFolders?.[0].uri.fsPath??"",t=require("os").homedir(),i=y.join(t,".vs-notebook-global"),s=new G(e,!1);u.window.registerTreeDataProvider("vs-notebook-notes",s),s.startWatching();let r=new G(i,!0);u.window.registerTreeDataProvider("vs-notebook-notes-global",r),r.startWatching();let a=new oe(e);o.subscriptions.push(u.languages.registerCodeLensProvider({scheme:"file"},a)),u.commands.registerCommand("vs-notebook.openSettings",()=>{u.commands.executeCommand("workbench.action.openSettings","@ext:brandonbridges.vs-notebook")}),o.subscriptions.push(u.commands.registerCommand("vs-notebook.openNote",h=>{u.workspace.openTextDocument(h).then(l=>{u.window.showTextDocument(l)})}),u.commands.registerCommand("vs-notebook.refreshNotes",()=>{s.refresh(),r.refresh(),a.refresh()}));let n=u.commands.registerCommand("vs-notebook.createNote",async()=>{let h=await u.window.showInputBox({prompt:"Enter note title"});if(!h)return;let l=await u.window.showInputBox({prompt:"Enter note description"}),f=await u.window.showInputBox({prompt:"Enter tags (comma-separated, optional)"}),d=u.window.activeTextEditor,m=d?.document.uri.fsPath??"Unknown",w=d?.selection,P=`title: ${h}
file: ${m}
`;if(w?.isEmpty){let L=w.active.line+1;P+=`line: ${L}
`}else if(w){let L=w.start.line+1,Oe=w.end.line+1;P+=`line: ${L}-${Oe}
`}P+=`tags: ${f||""}`,P+=`
url: `;let F=d?d.selection.active.line+1:"Unknown",I=u.workspace.workspaceFolders;if(!I){u.window.showErrorMessage("No workspace folder found.");return}let O=I[0].uri.fsPath,C=y.join(O,".vs-notebook"),V=y.join(C,`${h.replace(/\s+/g,"-")}.md`);E.existsSync(C)||E.mkdirSync(C,{recursive:!0});let re=`---
${P}
---

${l||""}`;E.writeFileSync(V,re),u.window.showInformationMessage(`Note "${h}" created.`),u.workspace.openTextDocument(V).then(L=>{u.window.showTextDocument(L,{viewColumn:u.ViewColumn.Beside,preserveFocus:!1,preview:!1})})}),c=u.commands.registerCommand("vs-notebook.createGlobalNote",async()=>{let h=await u.window.showInputBox({prompt:"Enter global note title"});if(!h)return;let l=await u.window.showInputBox({prompt:"Enter note description"}),f=await u.window.showInputBox({prompt:"Enter tags (comma-separated, optional)"});E.existsSync(i)||E.mkdirSync(i,{recursive:!0});let d=y.join(i,`${h.replace(/\s+/g,"-")}.md`),m=`---
title: ${h}
tags: ${f||""}
url: 
---

${l||""}`;E.writeFileSync(d,m),u.window.showInformationMessage(`Global note "${h}" created.`),u.workspace.openTextDocument(d).then(w=>{u.window.showTextDocument(w,{viewColumn:u.ViewColumn.Beside,preserveFocus:!1,preview:!1})}),r.refresh()});u.commands.registerCommand("vs-notebook.deleteNote",async h=>{let l=h.fullPath;await u.window.showWarningMessage("Are you sure you want to delete this note?",{modal:!0},"Yes","No")==="Yes"&&(await u.workspace.fs.delete(u.Uri.file(l)),u.window.showInformationMessage("Note deleted"),s.refresh(),r.refresh(),a.refresh())}),u.commands.registerCommand("vs-notebook.renameNote",async h=>{let l=h.fullPath,f=y.basename(l,".md"),d=await u.window.showInputBox({prompt:"Enter new note name",value:f});if(!d||d===f)return;let m=y.join(y.dirname(l),`${d.replace(/\s+/g,"-")}.md`);await u.workspace.fs.rename(u.Uri.file(l),u.Uri.file(m)),u.window.showInformationMessage("Note renamed"),s.refresh(),r.refresh(),a.refresh()}),u.commands.registerCommand("vs-notebook.openNotesForLine",(h,l)=>{let f=y.join(e,".vs-notebook");if(!E.existsSync(f))return;let d=E.readdirSync(f).filter(m=>m.endsWith(".md")).map(m=>y.join(f,m)).filter(m=>{let P=E.readFileSync(m,"utf8").match(/^---\n([\s\S]+?)\n---/);if(!P)return!1;let F=Object.fromEntries(P[1].split(`
`).map(I=>{let[O,...C]=I.split(":");return[O.trim(),C.join(":").trim()]}));return y.resolve(F.file??"")===y.resolve(h)&&parseInt(F.line??"")===l});d.length===0?u.window.showInformationMessage("No notes found for this line."):d.forEach(m=>{u.workspace.openTextDocument(m).then(w=>u.window.showTextDocument(w,{preview:!1}))})}),u.commands.registerCommand("vs-notebook.openNotesForRange",(h,l,f)=>{let d=y.join(e,".vs-notebook");if(!E.existsSync(d))return;let m=E.readdirSync(d).filter(w=>w.endsWith(".md")).map(w=>y.join(d,w)).filter(w=>{let F=E.readFileSync(w,"utf8").match(/^---\n([\s\S]+?)\n---/);if(!F)return!1;let I=Object.fromEntries(F[1].split(`
`).map(V=>{let[re,...L]=V.split(":");return[re.trim(),L.join(":").trim()]}));if(y.resolve(I.file??"")!==y.resolve(h))return!1;let O=I.lineStart?parseInt(I.lineStart):null,C=I.lineEnd?parseInt(I.lineEnd):null;return O===null||C===null?!1:!(C<l||O>f)});m.length===0?u.window.showInformationMessage("No notes found for this code block."):m.forEach(w=>{u.workspace.openTextDocument(w).then(P=>u.window.showTextDocument(P,{preview:!1}))})}),u.workspace.onDidSaveTextDocument(h=>{h.fileName.includes(".vs-notebook")&&(s.refresh(),r.refresh(),a.refresh())}),u.workspace.onDidChangeConfiguration(h=>{(h.affectsConfiguration("vs-notebook.groupBy")||h.affectsConfiguration("vs-notebook.tagIcons"))&&(s.refresh(),r.refresh())}),o.subscriptions.push(n),o.subscriptions.push(c),o.subscriptions.push({dispose:()=>{s.dispose(),r.dispose(),a.dispose()}})}function Tt(){}0&&(module.exports={activate,deactivate});
/*! Bundled license information:

chokidar/esm/index.js:
  (*! chokidar - MIT License (c) 2012 Paul Miller (paulmillr.com) *)
*/
