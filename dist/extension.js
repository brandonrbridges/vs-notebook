"use strict";var R=Object.create;var E=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var W=Object.getPrototypeOf,O=Object.prototype.hasOwnProperty;var _=(f,r)=>{for(var e in r)E(f,e,{get:r[e],enumerable:!0})},L=(f,r,e,l)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of M(r))!O.call(f,s)&&s!==e&&E(f,s,{get:()=>r[s],enumerable:!(l=U(r,s))||l.enumerable});return f};var w=(f,r,e)=>(e=f!=null?R(W(f)):{},L(r||!f||!f.__esModule?E(e,"default",{value:f,enumerable:!0}):e,f)),V=f=>L(E({},"__esModule",{value:!0}),f);var Y={};_(Y,{activate:()=>A,deactivate:()=>G});module.exports=V(Y);var o=w(require("vscode")),p=w(require("path")),g=w(require("fs"));var m=w(require("vscode")),I=w(require("fs")),y=w(require("path")),$=class{constructor(r){this.workspaceRoot=r}_onDidChangeTreeData=new m.EventEmitter;onDidChangeTreeData=this._onDidChangeTreeData.event;refresh(){this._onDidChangeTreeData.fire()}getTreeItem(r){return r}getChildren(r){if(!this.workspaceRoot)return m.window.showInformationMessage("No workspace open"),Promise.resolve([]);let e=y.join(this.workspaceRoot,".vs-notes");if(!I.existsSync(e))return Promise.resolve([]);if(r&&r instanceof S)return Promise.resolve(r.children);let s=I.readdirSync(e).filter(a=>a.endsWith(".md")).map(a=>{let c=y.join(e,a);return new P(a,c)}),i=m.workspace.getConfiguration("vs-notes").get("groupBy","none");if(i==="none")return Promise.resolve(s);let t=this.groupNotes(s,i);return Promise.resolve(t)}async search(r){if(!this.workspaceRoot)return[];let e=y.join(this.workspaceRoot,".vs-notes");if(!I.existsSync(e))return[];let l=I.readdirSync(e).filter(i=>i.endsWith(".md")),s=r.toLowerCase(),n=[];for(let i of l){let t=y.join(e,i);I.readFileSync(t,"utf-8").toLowerCase().includes(s)&&n.push(new P(i,t))}return n}groupNotes(r,e){switch(e){case"file":return this.groupByFile(r);case"tag":return this.groupByTag(r);default:return r}}groupByFile(r){let e=new Map;for(let s of r){let n=P.readFrontmatter(s.fullPath),i=n.file?y.basename(n.file):"Unknown File";e.has(i)||e.set(i,[]),e.get(i).push(s)}let l=[];for(let[s,n]of e)l.push(new S(s,n,"file"));return l.sort((s,n)=>s.label.localeCompare(n.label))}groupByTag(r){let e=new Map;for(let s of r){let i=P.readFrontmatter(s.fullPath).tags?.split(",").map(a=>a.trim()).filter(Boolean)??[],t=i.length>0?i[0]:"Untagged";t||(t="Untagged"),t=t.charAt(0).toUpperCase()+t.slice(1),e.has(t)||e.set(t,[]),e.get(t).push(s)}let l=[];for(let[s,n]of e)l.push(new S(s,n,"tag"));return l.sort((s,n)=>s.label.localeCompare(n.label))}},S=class extends m.TreeItem{constructor(e,l,s){super(e,m.TreeItemCollapsibleState.Expanded);this.label=e;this.children=l;this.groupType=s;this.tooltip=`${this.children.length} note${this.children.length!==1?"s":""}`,this.description=`${this.children.length}`,s==="file"?this.iconPath=new m.ThemeIcon("file"):this.iconPath=new m.ThemeIcon("tag"),this.contextValue="groupItem"}},P=class f extends m.TreeItem{constructor(e,l){super(e,m.TreeItemCollapsibleState.None);this.label=e;this.fullPath=l;let s=f.readFrontmatter(l),n=s.tags?.split(",").map(i=>i.trim())??[];n.includes("bug")?this.iconPath=new m.ThemeIcon("bug",new m.ThemeColor("errorForeground")):n.includes("todo")?this.iconPath=new m.ThemeIcon("checklist",new m.ThemeColor("charts.yellow")):n.includes("refactor")?this.iconPath=new m.ThemeIcon("tools",new m.ThemeColor("charts.blue")):this.iconPath=new m.ThemeIcon("note"),this.tooltip=`${e}
${s.file??""} : ${s.line??""}${s.tags?`
Tags: `+s.tags:""}`,this.description=s.file?`${y.basename(s.file)} ${s.tags?` \u2022 ${s.tags}`:""}`:"",this.command={command:"vs-notes.openNote",title:"Open Note",arguments:[this.fullPath]},this.resourceUri=m.Uri.file(this.fullPath),this.contextValue="noteItem"}static readFrontmatter(e){try{let s=I.readFileSync(e,"utf-8").match(/^---\n([\s\S]+?)\n---/);if(s){let i=s[1].split(`
`),t={};for(let a of i){let[c,...d]=a.split(":");t[c.trim()]=d.join(":").trim()}return{file:t.file,line:t.line,tags:t.tags}}}catch(l){console.error("Failed to read frontmatter:",l)}return{}}};var k=w(require("vscode")),x=w(require("fs")),b=w(require("path")),F=class{constructor(r){this.workspaceRoot=r;this.refreshNotes()}_onDidChangeCodeLenses=new k.EventEmitter;onDidChangeCodeLenses=this._onDidChangeCodeLenses.event;notes={};refreshNotes(){this.notes={};let r=b.join(this.workspaceRoot,".vs-notes");if(!x.existsSync(r))return;let e=x.readdirSync(r).filter(l=>l.endsWith(".md"));for(let l of e){let s=b.join(r,l),i=x.readFileSync(s,"utf8").match(/^---\n([\s\S]+?)\n---/);if(!i)continue;let t=Object.fromEntries(i[1].split(`
`).map(a=>{let[c,...d]=a.split(":");return[c.trim(),d.join(":").trim()]}));if(t.file&&t.line){let a=b.resolve(t.file),c=t.line,d=null,h=null;if(c.includes("-")){let u=c.split("-").map(v=>parseInt(v));u.length===2&&u.every(v=>!isNaN(v))&&(d=u[0]-1,h=u[1]-1)}else{let u=parseInt(c);isNaN(u)||(d=h=u-1)}d!==null&&h!==null&&(this.notes[a]||(this.notes[a]=[]),this.notes[a].push({start:d,end:h}))}}}refresh(){this.refreshNotes(),this._onDidChangeCodeLenses.fire()}provideCodeLenses(r){let e=b.resolve(r.uri.fsPath),s=(this.notes[e]??[]).reduce((i,t)=>{let a=t.start;return i[a]||(i[a]=[]),i[a].push(t),i},{}),n=[];return Object.entries(s).forEach(([i,t])=>{let a=parseInt(i),c=t.length,d=t.length===1&&t[0].start===t[0].end,h=d?`${c} note${c>1?"s":""} for this line`:`${c} note${c>1?"s":""} for lines ${t[0].start+1}-${t[0].end+1}`;n.push(new k.CodeLens(new k.Range(a,0,a,0),{title:h,command:d?"vs-notes.openNotesForLine":"vs-notes.openNotesForRange",arguments:d?[e,a+1]:[e,t[0].start+1,t[0].end+1]}))}),n}};function A(f){let r=o.workspace.workspaceFolders?.[0].uri.fsPath??"",e=new $(r);o.window.registerTreeDataProvider("vsnotesView",e);let l=new F(r);f.subscriptions.push(o.languages.registerCodeLensProvider({scheme:"file"},l)),o.commands.registerCommand("vs-notes.openSettings",()=>{o.commands.executeCommand("workbench.action.openSettings","@ext:brandonbridges.vs-notes")}),f.subscriptions.push(o.commands.registerCommand("vs-notes.openNote",n=>{o.workspace.openTextDocument(n).then(i=>{o.window.showTextDocument(i)})}),o.commands.registerCommand("vs-notes.refreshNotes",()=>{e.refresh(),l.refresh()}));let s=o.commands.registerCommand("vs-notes.createNote",async()=>{let n=await o.window.showInputBox({prompt:"Enter note title"});if(!n)return;let i=await o.window.showInputBox({prompt:"Enter note description"}),t=await o.window.showInputBox({prompt:"Enter tags (comma-separated, optional)"}),a=o.window.activeTextEditor,c=a?.document.uri.fsPath??"Unknown",d=a?.selection,h=`title: ${n}
file: ${c}
`;if(d?.isEmpty){let T=d.active.line+1;h+=`line: ${T}
`}else if(d){let T=d.start.line+1,B=d.end.line+1;h+=`line: ${T}-${B}
`}h+=`tags: ${t||""}`;let u=a?a.selection.active.line+1:"Unknown",v=o.workspace.workspaceFolders;if(!v){o.window.showErrorMessage("No workspace folder found.");return}let C=v[0].uri.fsPath,N=p.join(C,".vs-notes"),D=p.join(N,`${n.replace(/\s+/g,"-")}.md`);g.existsSync(N)||g.mkdirSync(N,{recursive:!0});let j=`---
${h}
---

${i||""}`;g.writeFileSync(D,j),o.window.showInformationMessage(`Note "${n}" created.`),o.workspace.openTextDocument(D).then(T=>{o.window.showTextDocument(T,{viewColumn:o.ViewColumn.Beside,preserveFocus:!1,preview:!1})})});o.commands.registerCommand("vs-notes.deleteNote",async n=>{let i=n.fullPath;await o.window.showWarningMessage("Are you sure you want to delete this note?",{modal:!0},"Yes","No")==="Yes"&&(await o.workspace.fs.delete(o.Uri.file(i)),o.window.showInformationMessage("Note deleted"),e.refresh(),l.refresh())}),o.commands.registerCommand("vs-notes.renameNote",async n=>{let i=n.fullPath,t=p.basename(i,".md"),a=await o.window.showInputBox({prompt:"Enter new note name",value:t});if(!a||a===t)return;let c=p.join(p.dirname(i),`${a.replace(/\s+/g,"-")}.md`);await o.workspace.fs.rename(o.Uri.file(i),o.Uri.file(c)),o.window.showInformationMessage("Note renamed"),e.refresh(),l.refresh()}),o.commands.registerCommand("vs-notes.openNotesForLine",(n,i)=>{let t=p.join(r,".vs-notes");if(!g.existsSync(t))return;let a=g.readdirSync(t).filter(c=>c.endsWith(".md")).map(c=>p.join(t,c)).filter(c=>{let h=g.readFileSync(c,"utf8").match(/^---\n([\s\S]+?)\n---/);if(!h)return!1;let u=Object.fromEntries(h[1].split(`
`).map(v=>{let[C,...N]=v.split(":");return[C.trim(),N.join(":").trim()]}));return p.resolve(u.file??"")===p.resolve(n)&&parseInt(u.line??"")===i});a.length===0?o.window.showInformationMessage("No notes found for this line."):a.forEach(c=>{o.workspace.openTextDocument(c).then(d=>o.window.showTextDocument(d,{preview:!1}))})}),o.commands.registerCommand("vs-notes.openNotesForRange",(n,i,t)=>{let a=p.join(r,".vs-notes");if(!g.existsSync(a))return;let c=g.readdirSync(a).filter(d=>d.endsWith(".md")).map(d=>p.join(a,d)).filter(d=>{let u=g.readFileSync(d,"utf8").match(/^---\n([\s\S]+?)\n---/);if(!u)return!1;let v=Object.fromEntries(u[1].split(`
`).map(D=>{let[j,...T]=D.split(":");return[j.trim(),T.join(":").trim()]}));if(p.resolve(v.file??"")!==p.resolve(n))return!1;let C=v.lineStart?parseInt(v.lineStart):null,N=v.lineEnd?parseInt(v.lineEnd):null;return C===null||N===null?!1:!(N<i||C>t)});c.length===0?o.window.showInformationMessage("No notes found for this code block."):c.forEach(d=>{o.workspace.openTextDocument(d).then(h=>o.window.showTextDocument(h,{preview:!1}))})}),o.workspace.onDidSaveTextDocument(n=>{n.fileName.includes(".vs-notes")&&(e.refresh(),l.refresh())}),o.workspace.onDidChangeConfiguration(n=>{n.affectsConfiguration("vs-notes.groupBy")&&e.refresh()}),f.subscriptions.push(s)}function G(){}0&&(module.exports={activate,deactivate});
